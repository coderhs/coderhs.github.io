<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>AWS ECR Lifecycle Policy - Harisankar P S | Ruby on Rails Developer</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Harisankar P S" /><meta name="description" content="How delete old and unused images in AWS ECR." /><meta name="keywords" content="space management, aws cost management, aws ecr, aws, ecr, docker, images, repository, cloud, server admin, server management" />






<meta name="generator" content="Hugo 0.152.2 with theme even" />


<link rel="canonical" href="https://hsps.in/post/aws-ecr-lifecycle-policy/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.4b8d38150cffb222fc5c75641f4b036f7a679a6734fad752c4c780cc9d028fe7.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">



<meta property="og:site_name" content="Harisankar P S | Ruby on Rails Developer" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="AWS ECR Lifecycle Policy" />
<meta property="og:url" content="https://hsps.in/post/aws-ecr-lifecycle-policy/" />
<meta property="og:description" content="How delete old and unused images in AWS ECR." />
<meta property="article:published_time" content="2024-04-06T06:21:43-07:00" />
<meta property="article:modified_time" content="2024-04-06T06:21:43-07:00" />
<meta property="article:author" content="" />
<meta property="article:tag" content="aws" />
<meta property="article:tag" content="ecr" />
<meta property="article:tag" content="docker" />
<meta property="article:tag" content="images" />
<meta property="article:tag" content="repository" />
<meta property="article:tag" content="cloud" />
<meta property="article:tag" content="server admin" />
<meta property="article:tag" content="server management" />
<meta property="og:image" content="https://hsps.in/images/og-base_hu_1d9f0436dfbf4b05.png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />


<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="AWS ECR Lifecycle Policy" />
<meta name="twitter:description" content="How delete old and unused images in AWS ECR." />
<meta name="twitter:image" content="https://hsps.in/images/og-base_hu_1d9f0436dfbf4b05.png" />


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "\"AWS ECR Lifecycle Policy\"",
  "url": "\"https://hsps.in/post/aws-ecr-lifecycle-policy/\"",
  "datePublished": "2024-04-06T06:21:43-07:00",
  "dateModified": "2024-04-06T06:21:43-07:00",
  "author": {
    "@type": "Person",
    "name": "null",
    "url": "https://hsps.in/about"
  },
  "publisher": {
    "@type": "Person",
    "name": "null"
  },
  "description": "\"How delete old and unused images in AWS ECR.\"",
  "wordCount":  426 ,
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "\"https://hsps.in/post/aws-ecr-lifecycle-policy/\""
  },
  "image": "\"https://hsps.in/images/og-base_hu_1d9f0436dfbf4b05.png\"",
  "keywords": "[\"aws\",\"ecr\",\"docker\",\"images\",\"repository\",\"cloud\",\"server admin\",\"server management\"]"
}
</script>


<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div class="reading-progress" id="reading-progress"></div>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">HsPS.in</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/post/">
        <li class="mobile-menu-item">Articles</li>
      </a><a href="/videos/">
        <li class="mobile-menu-item">Speaking</li>
      </a><a href="/about">
        <li class="mobile-menu-item">About</li>
      </a><a href="/subscribe">
        <li class="mobile-menu-item">Subscribe</li>
      </a><a href="/projects">
        <li class="mobile-menu-item">Projects</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

<div class="logo-wrapper">
  <a href="/" class="logo">HsPS.in</a>
  <br>
  <i>My thoughts and opinions</i>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item" style="margin-right: 1rem;">
        <a class="menu-item-link" href="/post/">Articles</a>
      </li><li class="menu-item" style="margin-right: 1rem;">
        <a class="menu-item-link" href="/videos/">Speaking</a>
      </li><li class="menu-item" style="margin-right: 1rem;">
        <a class="menu-item-link" href="/about">About</a>
      </li><li class="menu-item" style="margin-right: 1rem;">
        <a class="menu-item-link" href="/subscribe">Subscribe</a>
      </li><li class="menu-item" style="margin-right: 1rem;">
        <a class="menu-item-link" href="/projects">Projects</a>
      </li>
  </ul>
</nav>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-ME9J4YD4H0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-ME9J4YD4H0');
</script>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">AWS ECR Lifecycle Policy</h1>

      <div class="post-meta">
        <span class="post-time"> 2024-04-06 </span>
        <div class="post-category">
            <a href="/categories/aws/"> AWS </a>
            <a href="/categories/ecr/"> ECR </a>
            </div>
          <span class="more-meta"> 426 words </span>
          <span class="more-meta"> 2 mins read </span>
        
      </div>
    </header>

    
    <div class="post-content">
      <p>Amazon Elastic Container Registry (ECR) is a service provided by Amazon for hosting our Docker/container images. The cost of downloading these images to a server or ECS (Elastic Container Service) within the same zone is free. However, downloading or uploading from the public internet incurs costs, as does storage space usage.</p>
<p>During the development and deployment of your project, you may find yourself building images as frequently as every 30 minutes. This frequency reflects my own experience. Whenever new code is merged with the master branch, it triggers a code build pipeline. This pipeline ultimately pushes the latest image to ECR, typically tagged as &ldquo;latest.&rdquo; Consequently, the previous image remains in the repository but becomes untagged. While retaining a few versions of older deployments facilitates easy rollbacks, after a day or two, they tend to become redundant. At this juncture, they serve no purpose other than incurring storage costs.</p>
<p>To address this issue, ECR offers a setting called &ldquo;lifecycle policy.&rdquo; This feature enables us to define how to manage tagged or untagged images, including those matching specific patterns. Accessing this setting involves selecting the repository and then choosing the corresponding action. The lifecycle policies option appears in the dropdown menu.</p>
<p><img src="/images/aws_ecr/aws_under_actions.png" alt="Actions"></p>
<p>Selecting this option navigates to a page where you can manage your policies. If this is your first time setting up a policy, the page will be blank. In the example below, I already have one configured.</p>
<p><img src="/images/aws_ecr/lifecycle_policy_rules.png" alt="Lifecycle Policies"></p>
<p>Here, you have the option to perform a dry run of your rule before finalizing it. Once a rule is implemented and images are deleted, there is no undo functionality available.</p>
<p>The rules are defined based on a priority list, where rules with higher priority execute first. The priority is indicated numerically, with lower numbers signifying higher priority (i.e., Rule 1 executes before Rule 2, and so forth).</p>
<p><img src="/images/aws_ecr/rule_definition_page.png" alt="Rule Creation Page"></p>
<p><img src="/images/aws_ecr/image_status.png" alt="Image Status"></p>
<p>The rule I implemented for my organization specifies the deletion of all untagged images when the total count exceeds five. However, if any untagged images are deemed important, they are tagged with an alternate name and retained.</p>
<p>In conclusion, effectively managing Docker/container images in Amazon Elastic Container Registry (ECR) requires strategic utilization of its features, particularly the lifecycle policy setting. By defining rules for handling tagged and untagged images, organizations can optimize storage usage and minimize costs. Regularly reviewing and refining these policies ensures that the repository remains efficient and clutter-free, facilitating smoother development and deployment processes. With careful planning and implementation, ECR serves as a reliable and cost-effective solution for hosting containerized applications within the Amazon Web Services (AWS) ecosystem.</p>
    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/aws/">aws</a>
          <a href="/tags/ecr/">ecr</a>
          <a href="/tags/docker/">docker</a>
          <a href="/tags/images/">images</a>
          <a href="/tags/repository/">repository</a>
          <a href="/tags/cloud/">cloud</a>
          <a href="/tags/server-admin/">server admin</a>
          <a href="/tags/server-management/">server management</a>
          </div>
      
      
        <div class="related-posts">
          <h3>Related Articles</h3>
          <ul>
            
              <li>
                <a href="/post/ansible-to-install-docker-and-docker-compose-on-new-lightsail-instance/">Using Ansible to Install Docker and Docker Compose on New Lightsail Instance</a>
                <span class="related-post-date">2023-08-06</span>
              </li>
            
              <li>
                <a href="/post/setup-https-and-reverseproxy-to-docker-web-app/">Setup HTTP(s) and Reverse Proxy to Docker Web App</a>
                <span class="related-post-date">2023-08-03</span>
              </li>
            
              <li>
                <a href="/post/rails-copy-assets-bundler-cache-to-speed-up-build/">Rails Copy Assets bundler Cache to Speed Up Build</a>
                <span class="related-post-date">2023-08-01</span>
              </li>
            
              <li>
                <a href="/post/sidekiq-graceful-shutdown-in-fargate-ecs/">Sidekiq Graceful Shutdown in Fargate ECS</a>
                <span class="related-post-date">2023-07-30</span>
              </li>
            
              <li>
                <a href="/post/static-compile-crystal-lang-code-in-docker-and-create-a-small-image/">Statically Compile Crystal Program and Distribute as docker Image</a>
                <span class="related-post-date">2023-04-02</span>
              </li>
            
          </ul>
        </div>
      <div class="author-post-intro">
  <p>
    Hi, I'm Harisankar P S! I'm a Senior Software Architect, and this blog is where I share my thoughts on programming,
    devops, anything noteworthy. My primary focus is Ruby on Rails, but I also explore
    full-stack development, linux, go, rust and DevOps projects.
  </p>
  <p>
    If you're interested in collaborating or have a project in mind, feel free to <a href="mailto:projects@hsps.in">email me</a>.
  </p>
  <div class="author-subscribe">
    <p class="subscribe-label">Get new posts delivered to your inbox:</p>
    <script src="https://f.convertkit.com/ckjs/ck.5.js"></script>
    <form
      action="https://app.kit.com/forms/7897017/subscriptions"
      class="seva-form formkit-form"
      method="post"
      data-sv-form="7897017"
      data-uid="52c1473349"
      data-format="inline"
      data-version="5"
      data-options='{"settings":{"after_subscribe":{"action":"message","success_message":"Success! Now check your email to confirm your subscription.","redirect_url":"https://hsps.in"},"analytics":{"google":null,"fathom":null,"facebook":null,"segment":null,"pinterest":null,"sparkloop":null,"googletagmanager":null},"modal":{"trigger":"timer","scroll_percentage":null,"timer":5,"devices":"all","show_once_every":15},"powered_by":{"show":false,"url":"https://kit.com/features/forms?utm_campaign=poweredby&amp;utm_content=form&amp;utm_medium=referral&amp;utm_source=dynamic"},"recaptcha":{"enabled":false},"return_visitor":{"action":"show","custom_content":""},"slide_in":{"display_in":"bottom_right","trigger":"timer","scroll_percentage":null,"timer":5,"devices":"all","show_once_every":15},"sticky_bar":{"display_in":"top","trigger":"timer","scroll_percentage":null,"timer":5,"devices":"all","show_once_every":15}},"version":"5"}'
    >
      <div class="subscribe-form-row">
        <input
          class="formkit-input"
          name="email_address"
          aria-label="Email Address"
          placeholder="your@email.com"
          required=""
          type="email"
        />
        <button data-element="submit" class="formkit-submit formkit-submit">
          <div class="formkit-spinner"><div></div><div></div><div></div></div>
          <span>Subscribe</span>
        </button>
      </div>
      <ul class="formkit-alert formkit-alert-error" data-element="errors" data-group="alert"></ul>
    </form>
  </div>
</div>

      <nav class="post-nav">
        <a class="prev" href="/post/using-docker-postgres-to-take-sql-dump-from-aws-rds/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Using Docker to export &amp; import data from Amazon RDS</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/handle-ssh-idle-connections-handing-or-getting-disconnected/">
            <span class="next-text nav-default">Handle SSH Idle Connections Freezing shell or Getting Disconnected</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div class="giscus"></div>
  <script src="https://giscus.app/client.js"
          data-repo="coderhs/coderhs.github.io"
          data-repo-id="MDEwOlJlcG9zaXRvcnkyOTE1MzAxMjk="
          data-category="General"
          data-category-id="DIC_kwDOEWBlkc4CjKPc"
          data-mapping="pathname"
          data-strict="1"
          data-reactions-enabled="1"
          data-emit-metadata="1"
          data-input-position="top"
          data-theme="light"
          data-lang="en"
          data-loading="lazy"
          crossorigin="anonymous"
          async>
  </script>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://github.com/coderhs" class="iconfont icon-github" title="github"></a>
  
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2011 - 
    2026<span class="heart"><i class="iconfont icon-heart"></i></span><span>Harisankar P S</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








  
  <script>
    (function() {
      var progressBar = document.getElementById('reading-progress');
      if (!progressBar) return;
      window.addEventListener('scroll', function() {
        var scrollTop = window.scrollY || document.documentElement.scrollTop;
        var docHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        if (docHeight > 0) {
          var scrollPercent = (scrollTop / docHeight) * 100;
          progressBar.style.width = scrollPercent + '%';
        }
      });
    })();
  </script>

  
  <script>
    (function() {
      var codeBlocks = document.querySelectorAll('.highlight > .chroma, figure.highlight');
      codeBlocks.forEach(function(block) {
        var btn = document.createElement('button');
        btn.className = 'copy-code-btn';
        btn.textContent = 'Copy';
        btn.addEventListener('click', function() {
          var code = block.querySelector('code');
          if (!code) {
            code = block.querySelector('.code pre');
          }
          if (code) {
            navigator.clipboard.writeText(code.textContent).then(function() {
              btn.textContent = 'Copied!';
              setTimeout(function() { btn.textContent = 'Copy'; }, 2000);
            });
          }
        });
        block.style.position = 'relative';
        block.appendChild(btn);
      });
    })();
  </script>
</body>
</html>
