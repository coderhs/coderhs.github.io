<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Running Rails Migrations in AWS ECS Using AWS CLI - Harisankar P S | Ruby on Rails Developer</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Harisankar P S" /><meta name="description" content="Running Rails Migrations in AWS ECS Using AWS CLI " /><meta name="keywords" content="aws, ecs, rails, db, migrate" />






<meta name="generator" content="Hugo 0.152.2 with theme even" />


<link rel="canonical" href="https://hsps.in/post/run-rails-db-migrate-on-ecs-task-aws/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.4b8d38150cffb222fc5c75641f4b036f7a679a6734fad752c4c780cc9d028fe7.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">



<meta property="og:site_name" content="Harisankar P S | Ruby on Rails Developer" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Running Rails Migrations in AWS ECS Using AWS CLI" />
<meta property="og:url" content="https://hsps.in/post/run-rails-db-migrate-on-ecs-task-aws/" />
<meta property="og:description" content="Running Rails Migrations in AWS ECS Using AWS CLI " />
<meta property="article:published_time" content="2024-10-10T00:05:58-07:00" />
<meta property="article:modified_time" content="2024-10-10T00:05:58-07:00" />
<meta property="article:author" content="" />
<meta property="article:tag" content="aws" />
<meta property="article:tag" content="ecs" />
<meta property="article:tag" content="rails" />
<meta property="article:tag" content="db" />
<meta property="article:tag" content="migrate" />
<meta property="og:image" content="https://hsps.in/images/og-base_hu_f32a48e31c06355b.png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />


<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Running Rails Migrations in AWS ECS Using AWS CLI" />
<meta name="twitter:description" content="Running Rails Migrations in AWS ECS Using AWS CLI " />
<meta name="twitter:image" content="https://hsps.in/images/og-base_hu_f32a48e31c06355b.png" />


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "\"Running Rails Migrations in AWS ECS Using AWS CLI\"",
  "url": "\"https://hsps.in/post/run-rails-db-migrate-on-ecs-task-aws/\"",
  "datePublished": "2024-10-10T00:05:58-07:00",
  "dateModified": "2024-10-10T00:05:58-07:00",
  "author": {
    "@type": "Person",
    "name": "null",
    "url": "https://hsps.in/about"
  },
  "publisher": {
    "@type": "Person",
    "name": "null"
  },
  "description": "\"Running Rails Migrations in AWS ECS Using AWS CLI \"",
  "wordCount":  398 ,
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "\"https://hsps.in/post/run-rails-db-migrate-on-ecs-task-aws/\""
  },
  "image": "\"https://hsps.in/images/og-base_hu_f32a48e31c06355b.png\"",
  "keywords": "[\"aws\",\"ecs\",\"rails\",\"db\",\"migrate\"]"
}
</script>


<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div class="reading-progress" id="reading-progress"></div>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">HsPS.in</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/post/">
        <li class="mobile-menu-item">Articles</li>
      </a><a href="/videos/">
        <li class="mobile-menu-item">Speaking</li>
      </a><a href="/about">
        <li class="mobile-menu-item">About</li>
      </a><a href="/subscribe">
        <li class="mobile-menu-item">Subscribe</li>
      </a><a href="/projects">
        <li class="mobile-menu-item">Projects</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

<div class="logo-wrapper">
  <a href="/" class="logo">HsPS.in</a>
  <br>
  <i>My thoughts and opinions</i>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item" style="margin-right: 1rem;">
        <a class="menu-item-link" href="/post/">Articles</a>
      </li><li class="menu-item" style="margin-right: 1rem;">
        <a class="menu-item-link" href="/videos/">Speaking</a>
      </li><li class="menu-item" style="margin-right: 1rem;">
        <a class="menu-item-link" href="/about">About</a>
      </li><li class="menu-item" style="margin-right: 1rem;">
        <a class="menu-item-link" href="/subscribe">Subscribe</a>
      </li><li class="menu-item" style="margin-right: 1rem;">
        <a class="menu-item-link" href="/projects">Projects</a>
      </li>
  </ul>
</nav>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-ME9J4YD4H0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-ME9J4YD4H0');
</script>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Running Rails Migrations in AWS ECS Using AWS CLI</h1>

      <div class="post-meta">
        <span class="post-time"> 2024-10-10 </span>
        <div class="post-category">
            <a href="/categories/aws/"> aws </a>
            <a href="/categories/rails/"> rails </a>
            </div>
          <span class="more-meta"> 398 words </span>
          <span class="more-meta"> 2 mins read </span>
        
      </div>
    </header>

    
    <div class="post-content">
      <p>AWS ECS (Elastic Container Service) is a powerful Amazon Web Service that allows you to deploy Docker containers on various infrastructure options, including EC2 instances, Fargate (serverless containers), or even self-hosted servers. Being deeply integrated with AWS, ECS offers a cost-effective and seamless solution for managing containers in the Amazon ecosystem.</p>
<p>This guide assumes you are familiar with ECS and already have a task definition set up for your Rails application. Additionally, it assumes you know how to find your subnet ID and security group ID, as these will be required when running containers in your specific environment.</p>
<p>We will also cover how you can use the same approach to run one-off tasks in ECS.</p>
<h2 id="steps">Steps</h2>
<ol>
<li>
<p><strong>Install and Configure AWS CLI</strong>
Ensure the AWS CLI is installed on your local machine, and your credentials are configured.</p>
</li>
<li>
<p><strong>Prepare the Docker Image</strong>
Make sure the latest Docker image of your application is available in ECS.</p>
</li>
<li>
<p><strong>Collect Subnet ID and Security Group ID</strong>
Retrieve the necessary Subnet ID and Security Group ID from your AWS account. You can find this information from any of your currently running ECS tasks and copy it.</p>
</li>
<li>
<p><strong>Run the ECS Task</strong>
Use the following command to run your Rails migration task in ECS:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">aws ecs run-task  --cluster ecs-cluster-name
</span></span><span class="line"><span class="cl">                  --task-definition ecs-task-definition
</span></span><span class="line"><span class="cl">                  --launch-type FARGATE
</span></span><span class="line"><span class="cl">                  --network-configuration <span class="s2">&#34;awsvpcConfiguration={subnets=[subnet-id],securityGroups=[sg-id],assignPublicIp=DISABLED}&#34;</span>
</span></span><span class="line"><span class="cl">                  --overrides <span class="s1">&#39;{&#34;containerOverrides&#34;:[{&#34;name&#34;:&#34;rails-container-name-in-task-definition&#34;,&#34;command&#34;:[&#34;bundle&#34;, &#34;exec&#34;, &#34;rails&#34;, &#34;db:migrate&#34;]}]}&#39;</span>
</span></span><span class="line"><span class="cl">                  --count <span class="m">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This command will trigger the creation of a new ECS task that runs your database migration. However, note that you won&rsquo;t see the output directly from the command.</p>
</li>
<li>
<p><strong>Check Task Status and Logs</strong>
To verify if the migration completed successfully, you can either log into the ECS console or retrieve the task ID from the command&rsquo;s JSON output, which is under the <code>taskArn</code> key.</p>
<p>To fetch the logs from the task, use the following AWS CLI command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">aws logs get-log-events        --log-group-name <span class="s2">&#34;/ecs/my-log-group&#34;</span>        --log-stream-name <span class="s2">&#34;ecs/my-task-id/my-container-name&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p>PS: If you want to run a similar one of tasks just replace the  <code>command</code> value in the step 4 instructions.
eg: <code>[&quot;bundle&quot;, &quot;exec&quot;, &quot;rails&quot;, &quot;db:create&quot;]</code> or <code>[&quot;bundle&quot;, &quot;exec&quot;, &quot;rails&quot;, &quot;db:seed&quot;]</code></p>
<h2 id="automating-migrations-during-deployments">Automating Migrations During Deployments</h2>
<p>Running this migration task manually for every deployment isn&rsquo;t recommended. In our setup, this command is the final step in our AWS CodeBuild pipeline. Once a new Docker image is pushed to AWS ECR and the ECS cluster restart is triggered, this command runs automatically to handle the migrations.</p>
    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/aws/">aws</a>
          <a href="/tags/ecs/">ecs</a>
          <a href="/tags/rails/">rails</a>
          <a href="/tags/db/">db</a>
          <a href="/tags/migrate/">migrate</a>
          </div>
      
      
        <div class="related-posts">
          <h3>Related Articles</h3>
          <ul>
            
              <li>
                <a href="/post/sidekiq-graceful-shutdown-in-fargate-ecs/">Sidekiq Graceful Shutdown in Fargate ECS</a>
                <span class="related-post-date">2023-07-30</span>
              </li>
            
              <li>
                <a href="/post/change-action-mailer-settings-from-rails-console/">Change Action Mailer Settings From Rails Console</a>
                <span class="related-post-date">2024-10-07</span>
              </li>
            
              <li>
                <a href="/post/using-docker-postgres-to-take-sql-dump-from-aws-rds/">Using Docker to export &amp; import data from Amazon RDS</a>
                <span class="related-post-date">2024-09-23</span>
              </li>
            
              <li>
                <a href="/post/aws-ecr-lifecycle-policy/">AWS ECR Lifecycle Policy</a>
                <span class="related-post-date">2024-04-06</span>
              </li>
            
              <li>
                <a href="/post/create-json-payload-for-api-test-using-factory-bot/">Create JSON Payload for API Test Using Factory Bot</a>
                <span class="related-post-date">2023-08-05</span>
              </li>
            
          </ul>
        </div>
      <div class="author-post-intro">
  <p>
    Hi, I'm Harisankar P S! I'm a Senior Software Architect, and this blog is where I share my thoughts on programming,
    devops, anything noteworthy. My primary focus is Ruby on Rails, but I also explore
    full-stack development, linux, go, rust and DevOps projects.
  </p>
  <p>
    If you're interested in collaborating or have a project in mind, feel free to <a href="mailto:projects@hsps.in">email me</a>.
  </p>
  <div class="author-subscribe">
    <p class="subscribe-label">Get new posts delivered to your inbox:</p>
    <script src="https://f.convertkit.com/ckjs/ck.5.js"></script>
    <form
      action="https://app.kit.com/forms/7897017/subscriptions"
      class="seva-form formkit-form"
      method="post"
      data-sv-form="7897017"
      data-uid="52c1473349"
      data-format="inline"
      data-version="5"
      data-options='{"settings":{"after_subscribe":{"action":"message","success_message":"Success! Now check your email to confirm your subscription.","redirect_url":"https://hsps.in"},"analytics":{"google":null,"fathom":null,"facebook":null,"segment":null,"pinterest":null,"sparkloop":null,"googletagmanager":null},"modal":{"trigger":"timer","scroll_percentage":null,"timer":5,"devices":"all","show_once_every":15},"powered_by":{"show":false,"url":"https://kit.com/features/forms?utm_campaign=poweredby&amp;utm_content=form&amp;utm_medium=referral&amp;utm_source=dynamic"},"recaptcha":{"enabled":false},"return_visitor":{"action":"show","custom_content":""},"slide_in":{"display_in":"bottom_right","trigger":"timer","scroll_percentage":null,"timer":5,"devices":"all","show_once_every":15},"sticky_bar":{"display_in":"top","trigger":"timer","scroll_percentage":null,"timer":5,"devices":"all","show_once_every":15}},"version":"5"}'
    >
      <div class="subscribe-form-row">
        <input
          class="formkit-input"
          name="email_address"
          aria-label="Email Address"
          placeholder="your@email.com"
          required=""
          type="email"
        />
        <button data-element="submit" class="formkit-submit formkit-submit">
          <div class="formkit-spinner"><div></div><div></div><div></div></div>
          <span>Subscribe</span>
        </button>
      </div>
      <ul class="formkit-alert formkit-alert-error" data-element="errors" data-group="alert"></ul>
    </form>
  </div>
</div>

      <nav class="post-nav">
        <a class="prev" href="/post/setup-master-slave-database-on-postgresql-17/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Setup Read Replica (master-slave) Database on Postgresql 17</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/setup-on-demand-tailscale-exit-node-using-terraform-and-digital-ocean/">
            <span class="next-text nav-default">Setup on Demand Tailscale Exit Node Using Terraform and DigitalOcean</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div class="giscus"></div>
  <script src="https://giscus.app/client.js"
          data-repo="coderhs/coderhs.github.io"
          data-repo-id="MDEwOlJlcG9zaXRvcnkyOTE1MzAxMjk="
          data-category="General"
          data-category-id="DIC_kwDOEWBlkc4CjKPc"
          data-mapping="pathname"
          data-strict="1"
          data-reactions-enabled="1"
          data-emit-metadata="1"
          data-input-position="top"
          data-theme="light"
          data-lang="en"
          data-loading="lazy"
          crossorigin="anonymous"
          async>
  </script>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://github.com/coderhs" class="iconfont icon-github" title="github"></a>
  
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2011 - 
    2026<span class="heart"><i class="iconfont icon-heart"></i></span><span>Harisankar P S</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








  
  <script>
    (function() {
      var progressBar = document.getElementById('reading-progress');
      if (!progressBar) return;
      window.addEventListener('scroll', function() {
        var scrollTop = window.scrollY || document.documentElement.scrollTop;
        var docHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        if (docHeight > 0) {
          var scrollPercent = (scrollTop / docHeight) * 100;
          progressBar.style.width = scrollPercent + '%';
        }
      });
    })();
  </script>

  
  <script>
    (function() {
      var codeBlocks = document.querySelectorAll('.highlight > .chroma, figure.highlight');
      codeBlocks.forEach(function(block) {
        var btn = document.createElement('button');
        btn.className = 'copy-code-btn';
        btn.textContent = 'Copy';
        btn.addEventListener('click', function() {
          var code = block.querySelector('code');
          if (!code) {
            code = block.querySelector('.code pre');
          }
          if (code) {
            navigator.clipboard.writeText(code.textContent).then(function() {
              btn.textContent = 'Copied!';
              setTimeout(function() { btn.textContent = 'Copy'; }, 2000);
            });
          }
        });
        block.style.position = 'relative';
        block.appendChild(btn);
      });
    })();
  </script>
</body>
</html>
